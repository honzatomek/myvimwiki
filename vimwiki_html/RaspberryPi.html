<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="date" content="2020-06-08" scheme="YYYY-MM-DD">
        <meta name="viewport" content="width=device-width" />
        <title>RaspberryPi</title>
        <link rel="stylesheet" href="./style.css" type="text/css"
         media="screen" title="no title" charset="utf-8">
        <link rel="stylesheet" href="./pygmentize.css" type="text/css"
         media="screen" title="no title" charset="utf-8">
    </head>
    <body>

<p>:Raspbery:RaspberryPi:RPi:RasPi:</p>
<h1>Contents</h1>
<ul>
<li><a href="#SSH">SSH</a><ul>
<li><a href="#SSH#key%20conversion">key conversion</a><ul>
<li><a href="#SSH#key%20conversion#to%20OpenSSH">to OpenSSH</a></li>
<li><a href="#SSH#key%20conversion#from%20OpenSSH">from OpenSSH</a></li>
<li><a href="#SSH#key%20conversion#export%20to%20file">export to file</a></li>
<li><a href="#SSH#key%20conversion#add%20the%20key%20to%20authorized_keys">add the key to authorized_keys</a></li>
<li><a href="#SSH#key%20conversion#automation%20by%20script">automation by script</a></li>
</ul>
</li>
<li><a href="#SSH#ssh%20setup">ssh setup</a></li>
<li><a href="#SSH#Xming">Xming</a><ul>
<li><a href="#SSH#Xming#setup">setup</a></li>
<li><a href="#SSH#Xming#reset">reset</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#WLAN">WLAN</a><ul>
<li><a href="#WLAN#network%20devices">network devices</a><ul>
<li><a href="#WLAN#network%20devices#show">show</a></li>
<li><a href="#WLAN#network%20devices#info">info</a></li>
<li><a href="#WLAN#network%20devices#naming%20rules">naming rules</a></li>
<li><a href="#WLAN#network%20devices#persistent%20name">persistent name</a></li>
</ul>
</li>
<li><a href="#WLAN#WLAN%20Hotspot">WLAN Hotspot</a><ul>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+">Raspberry Pi3 B+</a><ul>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#packages">packages</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#Network%20interface%20configuration">Network interface configuration</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#hostapd%20configuration">hostapd configuration</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#dnsmasq%20configuration">dnsmasq configuration</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#IPv4%20Forwarding%20configuration">IPv4 Forwarding configuration</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#Finish">Finish</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#Notes">Notes</a></li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi3%20B+#script%20for%20wlan0">script for wlan0</a></li>
</ul>
</li>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi%204">Raspberry Pi 4</a><ul>
<li><a href="#WLAN#WLAN%20Hotspot#Raspberry%20Pi%204#wlan1">wlan1</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#swap%20size">swap size</a></li>
</ul>
<h1>SSH</h1>
<h2>key conversion</h2>
<h3>to OpenSSH</h3>
<div class="codehilite"><pre><span></span>ssh-keygen -i -f FILE_IN.ppk
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">output</span> <span class="n">of</span> <span class="sb">`man ssh-keygen`</span><span class="p">:</span>

 <span class="o">-</span><span class="n">i</span>      <span class="n">This</span> <span class="n">option</span> <span class="n">will</span> <span class="n">read</span> <span class="n">an</span> <span class="n">unencrypted</span> <span class="n">private</span> <span class="p">(</span><span class="ow">or</span> <span class="n">public</span><span class="p">)</span> <span class="n">key</span> <span class="nb">file</span>
     <span class="ow">in</span> <span class="n">the</span> <span class="n">format</span> <span class="n">specified</span> <span class="n">by</span> <span class="n">the</span> <span class="o">-</span><span class="n">m</span> <span class="n">option</span> <span class="ow">and</span> <span class="k">print</span> <span class="n">an</span> <span class="n">OpenSSH</span>
     <span class="n">compatible</span> <span class="n">private</span> <span class="p">(</span><span class="ow">or</span> <span class="n">public</span><span class="p">)</span> <span class="n">key</span> <span class="n">to</span> <span class="n">stdout</span><span class="o">.</span>  <span class="n">This</span> <span class="n">option</span> <span class="n">allows</span>
     <span class="n">importing</span> <span class="n">keys</span> <span class="kn">from</span> <span class="nn">other</span> <span class="nn">software</span><span class="p">,</span> <span class="n">including</span> <span class="n">several</span> <span class="n">commercial</span>
     <span class="n">SSH</span> <span class="n">implementations</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="kn">import</span> <span class="nn">format</span> <span class="nn">is</span> <span class="err">“</span><span class="n">RFC4716</span><span class="err">”</span><span class="o">.</span>

 <span class="o">-</span><span class="n">f</span> <span class="n">filename</span>
         <span class="n">Specifies</span> <span class="n">the</span> <span class="n">filename</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span> <span class="nb">file</span><span class="o">.</span>

 <span class="o">-</span><span class="n">m</span> <span class="n">key_format</span>
     <span class="n">Specify</span> <span class="n">a</span> <span class="n">key</span> <span class="n">format</span> <span class="k">for</span> <span class="n">the</span> <span class="o">-</span><span class="n">i</span> <span class="p">(</span><span class="n">import</span><span class="p">)</span> <span class="ow">or</span> <span class="o">-</span><span class="n">e</span> <span class="p">(</span><span class="n">export</span><span class="p">)</span> <span class="n">conversion</span>
     <span class="n">options</span><span class="o">.</span>  <span class="n">The</span> <span class="n">supported</span> <span class="n">key</span> <span class="n">formats</span> <span class="n">are</span><span class="p">:</span> <span class="err">“</span><span class="n">RFC4716</span><span class="err">”</span> <span class="p">(</span><span class="n">RFC</span> <span class="mi">4716</span><span class="o">/</span><span class="n">SSH2</span>
     <span class="n">public</span> <span class="ow">or</span> <span class="n">private</span> <span class="n">key</span><span class="p">),</span> <span class="err">“</span><span class="n">PKCS8</span><span class="err">”</span> <span class="p">(</span><span class="n">PEM</span> <span class="n">PKCS8</span> <span class="n">public</span> <span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="err">“</span><span class="n">PEM</span><span class="err">”</span>
     <span class="p">(</span><span class="n">PEM</span> <span class="n">public</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span>  <span class="n">The</span> <span class="n">default</span> <span class="n">conversion</span> <span class="n">format</span> <span class="ow">is</span> <span class="err">“</span><span class="n">RFC4716</span><span class="err">”</span><span class="o">.</span>
     <span class="n">Setting</span> <span class="n">a</span> <span class="n">format</span> <span class="n">of</span> <span class="err">“</span><span class="n">PEM</span><span class="err">”</span> <span class="n">when</span> <span class="n">generating</span> <span class="ow">or</span> <span class="n">updating</span> <span class="n">a</span> <span class="n">supported</span>
     <span class="n">private</span> <span class="n">key</span> <span class="nb">type</span> <span class="n">will</span> <span class="n">cause</span> <span class="n">the</span> <span class="n">key</span> <span class="n">to</span> <span class="n">be</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">legacy</span> <span class="n">PEM</span>
     <span class="n">private</span> <span class="n">key</span> <span class="n">format</span><span class="o">.</span>
</pre></div>


<h3>from OpenSSH</h3>
<div class="codehilite"><pre><span></span>ssh-keygen -e -f FILE_IN.ppk
</pre></div>


<div class="codehilite"><pre><span></span>output of `man ssh-keygen`:

 -e      This option will read a private or public OpenSSH key file and
     print to stdout the key in one of the formats specified by the -m
     option. The default export format is “RFC4716”.  This option
     allows exporting OpenSSH keys for use by other programs, including
     several commercial SSH implementations.
</pre></div>


<h3>export to file</h3>
<div class="codehilite"><pre><span></span>ssh-keygen -i -f FILE_IN.ppk &gt; FILE_OUT.ppk
</pre></div>


<h3>add the key to authorized_keys</h3>
<div class="codehilite"><pre><span></span>ssh-keygen -i -f FILE_IN.ppk &gt;&gt; <span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.ssh/authorized_keys&quot;</span>
</pre></div>


<h3>automation by script</h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">HELP</span><span class="o">=</span><span class="s1">&#39;Script to turn ssh.ppk key from Puttygen to linux format</span>
<span class="s1">Use: ./ssh_key_to_linux.sh FILE_IN FILE_OUT</span>

<span class="s1">FILE_IN   *.ppk  file generated from Puttygen</span>
<span class="s1">FILE_OUT  *.ppk  for the ssh key in new format</span>

<span class="s1">if FILE_OUT is not specified then the key is appended to ~/.ssh/authorized_keys</span>
<span class="s1">if FILE_OUT exists, the key is appened to it.&#39;</span>

<span class="nv">FILE_IN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">FILE_OUT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">PARAMS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="k">while</span> <span class="o">((</span> <span class="s2">&quot;</span><span class="nv">$#</span><span class="s2">&quot;</span> <span class="o">))</span><span class="p">;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
    <span class="c1"># parsing optional arguments</span>
    -h<span class="p">|</span>--help<span class="o">)</span> <span class="nv">HLP</span><span class="o">=</span>true<span class="p">;</span> <span class="nb">shift</span> <span class="p">;;</span>
    <span class="c1"># end argument parsing</span>
    -<span class="p">|</span>--<span class="o">)</span> shift<span class="p">;</span> <span class="nb">break</span> <span class="p">;;</span>
    <span class="c1"># unsupported flags</span>
    -*<span class="p">|</span>--*<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;[-] Error: Unsupported flag  </span><span class="nv">$1</span><span class="s2">&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">exit</span> <span class="m">1</span> <span class="p">;;</span>
    <span class="c1"># preserve positional arguments</span>
    *<span class="o">)</span>
      <span class="nv">PARAMS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PARAMS</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">&quot;</span>
      <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$FILE_IN</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">FILE_IN</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
    <span class="nb">shift</span>
      <span class="k">else</span>
        <span class="nv">FILE_OUT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
        <span class="nb">break</span>
      <span class="k">fi</span>
  <span class="k">esac</span>
<span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$FILE_IN</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;[-] Error, the FILE_IN was not supplied.&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$HELP</span><span class="s2">&quot;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nb">eval</span> <span class="nb">set</span> -- <span class="s2">&quot;</span><span class="nv">$PARAMS</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$FILE_OUT</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nv">FILE_OUT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.ssh/authorized_keys&quot;</span>
<span class="k">fi</span>

<span class="c1"># echo &quot;[+] Whole command:  ssh_key_to_linux.sh $PARAMS&quot;</span>
<span class="c1"># echo &quot;[+] Used command:   ssh_key_to_linux.sh $FILE_IN $FILE_OUT&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] Command to be used:&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;      ssh-keygen -i -f </span><span class="nv">$FILE_IN</span><span class="s2"> &gt;&gt; </span><span class="nv">$FILE_OUT</span><span class="s2">&quot;</span>
<span class="nb">echo</span> -e <span class="s2">&quot;[+] Preview of the output:\n&quot;</span>
<span class="nv">output</span><span class="o">=</span><span class="k">$(</span>ssh-keygen -i -f <span class="s2">&quot;</span><span class="nv">$FILE_IN</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">\n&quot;</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;[-] Input key in a wrong format, must be a public key.&quot;</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;    Trying ssh-keygen export:\n&quot;</span>
  <span class="nv">output</span><span class="o">=</span><span class="k">$(</span>ssh-keygen -e -f <span class="s2">&quot;</span><span class="nv">$FILE_IN</span><span class="s2">&quot;</span><span class="k">)</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\n[-] The key supplied in </span><span class="nv">$FILE_IN</span><span class="s2"> is wrong.&quot;</span>
  <span class="k">else</span>
     <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;    Exiting..&quot;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
<span class="nb">read</span> -p <span class="s2">&quot;[+] Do you want to append this key to </span><span class="nv">$FILE_OUT</span><span class="s2">? [y/n] &quot;</span> choice
  <span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$choice</span><span class="s2">&quot;</span> in
    <span class="o">[</span>yY<span class="o">]</span><span class="p">|</span><span class="o">[</span>yY<span class="o">][</span>eE<span class="o">][</span>sS<span class="o">])</span>
      <span class="nb">echo</span> <span class="s2">&quot;    yes&quot;</span>
      ssh-keygen -i -f <span class="s2">&quot;</span><span class="nv">$FILE_IN</span><span class="s2">&quot;</span> &gt;&gt; <span class="s2">&quot;</span><span class="nv">$FILE_OUT</span><span class="s2">&quot;</span>
      <span class="nb">echo</span> <span class="s2">&quot;[+] The key was successfully exported to: </span><span class="nv">$FILE_OUT</span><span class="s2">&quot;</span>
      <span class="nb">exit</span> <span class="m">1</span><span class="p">;;</span>
    <span class="o">[</span>nN<span class="o">]</span><span class="p">|</span><span class="o">[</span>nN<span class="o">][</span>oO<span class="o">])</span> <span class="nb">echo</span> <span class="s2">&quot;[-] The script was ended by user input -&gt; exiting..&quot;</span><span class="p">;</span> <span class="nb">exit</span> <span class="m">1</span> <span class="p">;;</span>
    *<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;[-] Please answer yes or no.&quot;</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</pre></div>


<h2>ssh setup</h2>
<p>https://stackoverflow.com/questions/16212816/setting-up-openssh-for-windows-using-public-key-authentication/50502015#50502015</p>
<p>Following are setup steps for OpenSSH shipped with Windows 10 v.1803 (April
2018 update. See comments to this post, it might not work with 1809).</p>
<p>Server setup (<em>elevated powershell</em>):</p>
<p>Install OpenSSH server:
<code>Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0.</code></p>
<p>Start agent and sshd services:
<code>Start-Service ssh-agent; Start-Service sshd</code>
(this will generate host keys and default configuration automatically in
<em>$env:ProgramData\ssh</em>).</p>
<p>[Optional] Install OpenSSHUtils powershell module:
<code>Install-Module -Force OpenSSHUtils</code></p>
<p>Client setup (<em>non-elevated powershell</em>):</p>
<p>Generate user key:
<code>cd $env:USERPROFILE\.ssh; ssh-keygen.exe</code>
follow prompts, agree to the default suggested file location. This will create
2 files: <em>id_rsa</em> and <em>id_rsa.pub</em>;</p>
<p>[Optional] add key to authentication agent, so you don't have to enter password
each time you use it:
<code>ssh-add .\id_rsa</code>
(or whatever file was generated);</p>
<p>Server setup continued (non-elevated powershell):</p>
<p>Log in as a user, for which public key auth to be used
<code>cd $env:USERPROFILE; mkdir .ssh; cd .ssh; New-Item authorized_keys;</code></p>
<p>Paste the contents of the <em>id_rsa.pub file</em> from the client to the
<em>.ssh\authorized_keys</em> file from the previous step. Setup permissions properly
(important!!!):</p>
<p>Run:
<code>start .</code></p>
<p>to open explorer with the current folder (<em>$env:USERPROFILE.ssh</em>); Right click
authorized_keys, go to <em>Properties -&gt; Security -&gt; Advanced</em>. Click "Disable
inheritance"; Choose "Convert inherited permissions into explicit permissions
on this object" when prompted; (really, really important) Remove all
permissions on file except for the SYSTEM and yourself. There must be exactly
two permission entries on the file. Some guides suggest running the</p>
<p><code>Repair-AuthorizedKeyPermission $env:USERPROFILE\.ssh\authorized_keys</code></p>
<p>this will try to add the sshd user to the permission list and it will break the
authentication, so, don't do that, or at least do not agree on adding the sshd
user). Both SYSTEM and yourself should have full control over the file.</p>
<p>Client:
Run</p>
<p><code>ssh &lt;serverusername&gt;@&lt;serverhostname&gt;</code></p>
<p>It should work at this point. Tried that with Windows 10 as server and both
itself and a Debian Linux as a client.</p>
<p>EDIT: (see comment section below) Current windows build require to also comment
out the following in</p>
<div class="codehilite"><pre><span></span><span class="nb">PS </span><span class="n">C</span><span class="err">:</span><span class="p">\</span><span class="n">ProgramData</span><span class="p">\</span><span class="n">ssh</span><span class="p">&gt;</span> <span class="n">bash</span> <span class="n">-c</span> <span class="s1">&#39;vim sshd_config&#39;</span>

<span class="c"># Match Group administrators</span>
<span class="c">#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys</span>
</pre></div>


<h2>Xming</h2>
<h3>setup</h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;/etc/ssh/ssh_config&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;[+] Editing /etc/ssh/ssh_config&quot;</span>
  sudo cp /etc/ssh/ssh_config /etc/ssh/ssh_config.orig
  sudo sed -i -e <span class="s1">&#39;s/#   ForwardX11 yes/ForwardX11 yes/g&#39;</span> /etc/ssh/ssh_config
  sudo sed -i -e <span class="s1">&#39;s/#   ForwardX11 no/ForwardX11 yes/g&#39;</span> /etc/ssh/ssh_config
  sudo sed -i -e <span class="s1">&#39;s/#   ForwardX11Trusted yes/ForwardX11Trusted yes/g&#39;</span> /etc/ssh/ssh_config
  sudo sed -i -e <span class="s1">&#39;s/#   ForwardX11Trusted no/ForwardX11Trusted yes/g&#39;</span> /etc/ssh/ssh_config
  sudo sed -i -e <span class="s1">&#39;s/ForwardX11Trusted no/ForwardX11Trusted yes/g&#39;</span> /etc/ssh/ssh_config
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;/etc/ssh/sshd_config&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;[+] Editing /etc/ssh/sshd_config&quot;</span>
  sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.orig
  sudo sed -i -e <span class="s1">&#39;s/X11Forwarding no/X11Forwarding yes/g&#39;</span> /etc/ssh/sshd_config
  sudo sed -i -e <span class="s1">&#39;s/#X11Forwarding yes/X11Frowarding yes/g&#39;</span> /etc/ssh/sshd_config
  sudo sed -i -e <span class="s1">&#39;s/#X11DisplayOffset 10/X11DisplayOffset 10/g&#39;</span> /etc/ssh/sshd_config
<span class="k">fi</span>

/etc/init.d/ssh restart
</pre></div>


<h3>reset</h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

sudo cp /etc/ssh/ssh_config.orig /etc/ssh/ssh_config
sudo cp /etc/ssh/sshd_config.orig /etc/ssh/sshd_config

/etc/init.d/ssh restart
</pre></div>


<h1>WLAN</h1>
<h2>network devices</h2>
<h3>show</h3>
<div class="codehilite"><pre><span></span>ifconfig
</pre></div>


<h3>info</h3>
<p>show info on network device:</p>
<div class="codehilite"><pre><span></span>udevadm info /sys/class/net/wlan1
</pre></div>


<p>show full info on network device:</p>
<div class="codehilite"><pre><span></span>udevadm info /sys/class/net/wlan1 --attribute-walk
</pre></div>


<h3>naming rules</h3>
<p>test rules used for naming the device</p>
<div class="codehilite"><pre><span></span>sudo udevadm <span class="nb">test</span> /sys/class/net/wlan1
</pre></div>


<p>location of rules for naming the devices (in hierarchic order, first wins):</p>
<div class="codehilite"><pre><span></span>/etc/udev/rules.d/
/lib/udev/rules.d/
</pre></div>


<h3>persistent name</h3>
<p>naming rule example for <em>/etc/udev/rules.d/70-persistent-net.rules</em>
keywords can be selected based upon udevadm info <code>/sys/class/net/wlan1 --attribute-walk</code> output</p>
<div class="codehilite"><pre><span></span><span class="nv">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span>, <span class="nv">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span>, <span class="nv">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span>, ATTR<span class="o">{</span>address<span class="o">}==</span><span class="s2">&quot;b8:27:eb:fd:28:27&quot;</span>, ATTR<span class="o">{</span>type<span class="o">}==</span><span class="s2">&quot;1&quot;</span>, <span class="nv">KERNEL</span><span class="o">==</span><span class="s2">&quot;wlan*&quot;</span>, <span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;wlan0&quot;</span>
<span class="nv">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span>, <span class="nv">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span>, <span class="nv">DRIVERS</span><span class="o">==</span><span class="s2">&quot;?*&quot;</span>, ATTR<span class="o">{</span>address<span class="o">}==</span><span class="s2">&quot;00:ad:24:42:ce:6e&quot;</span>, ATTR<span class="o">{</span>type<span class="o">}==</span><span class="s2">&quot;1&quot;</span>, <span class="nv">KERNEL</span><span class="o">==</span><span class="s2">&quot;wlan*&quot;</span>, <span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;wlan1&quot;</span>
</pre></div>


<p>for the naming rules to work, a following symlink has to be created:</p>
<div class="codehilite"><pre><span></span>ln -s /lib/udev/rules.d/80-net-setup-link.rules /etc/udev/rules.d/80-net-setup-link.rules
</pre></div>


<h2>WLAN Hotspot</h2>
<h3>Raspberry Pi3 B+</h3>
<h4>packages</h4>
<div class="codehilite"><pre><span></span>hostapd – This package allows for creation of WiFi hotspot
dnsmasq – A combination of DHCP and DNS server
</pre></div>


<h4>Network interface configuration</h4>
<p>We have to set up a static IP address of <em>wlan0</em> device.</p>
<p>First we have to edit <em>dhcpd</em> config file to ignore <em>wlan0</em> device.</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/dhcpcd.conf
</pre></div>


<p>Insert on the last row:</p>
<div class="codehilite"><pre><span></span>denyinterfaces wlan0
</pre></div>


<p>Then we have to set up our <em>static IP address</em>:</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/network/interfaces
</pre></div>


<p>Where we edit <em>wlan0</em> section to look like this:</p>
<div class="codehilite"><pre><span></span>allow-hotplug wlan0
iface wlan0 inet static
    address <span class="m">192</span>.168.1.1
    netmask <span class="m">255</span>.255.255.0
    network <span class="m">192</span>.168.1.0
    broadcast <span class="m">192</span>.168.1.255
<span class="c1">#   wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</span>
</pre></div>


<p>As a last step we restart <em>dhcpcd</em>:</p>
<div class="codehilite"><pre><span></span>sudo service dhcpcd restart
</pre></div>


<p>And reread <em>wlan0</em> config:</p>
<div class="codehilite"><pre><span></span>sudo ifdown wlan0<span class="p">;</span> sudo ifup wlan0
</pre></div>


<p>:hostapd:</p>
<h4>hostapd configuration</h4>
<p>Next we have to set up <em>hostapd</em>. Let us therefore creat a new config file:</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/hostapd/hostapd.conf
</pre></div>


<p>and insert the following content to be then modified based on our needs
(<em>ssid</em> = name of wifi network, <em>wpa_passphrase</em> = wifi network password).
If you use a <space>, enclose the whole string in "".</p>
<div class="codehilite"><pre><span></span><span class="c1"># This is the name of the WiFi interface we configured above</span>
<span class="nv">interface</span><span class="o">=</span>wlan0
<span class="c1"># Use the nl80211 driver with the brcmfmac driver</span>
<span class="nv">driver</span><span class="o">=</span>nl80211
<span class="c1"># This is the name of the network</span>
<span class="nv">ssid</span><span class="o">=</span>SSID_VASI_WIFI
<span class="c1"># Use the 2.4GHz band</span>
<span class="nv">hw_mode</span><span class="o">=</span>g
<span class="c1"># Use channel 6</span>
<span class="nv">channel</span><span class="o">=</span><span class="m">6</span>
<span class="c1"># Enable 802.11n</span>
<span class="nv">ieee80211n</span><span class="o">=</span><span class="m">1</span>
<span class="c1"># Enable WMM</span>
<span class="nv">wmm_enabled</span><span class="o">=</span><span class="m">1</span>
<span class="c1"># Enable 40MHz channels with 20ns guard interval</span>
<span class="nv">ht_capab</span><span class="o">=[</span>HT40<span class="o">][</span>SHORT-GI-20<span class="o">][</span>DSSS_CCK-40<span class="o">]</span>
<span class="c1"># Accept all MAC addresses</span>
<span class="nv">macaddr_acl</span><span class="o">=</span><span class="m">0</span>
<span class="c1"># Use WPA authentication</span>
<span class="nv">auth_algs</span><span class="o">=</span><span class="m">1</span>
<span class="c1"># Require clients to know the network name</span>
<span class="nv">ignore_broadcast_ssid</span><span class="o">=</span><span class="m">0</span>
<span class="c1"># Use WPA2</span>
<span class="nv">wpa</span><span class="o">=</span><span class="m">2</span>
<span class="c1"># Use a pre-shared key</span>
<span class="nv">wpa_key_mgmt</span><span class="o">=</span>WPA-PSK
<span class="c1"># The network passphrase</span>
<span class="nv">wpa_passphrase</span><span class="o">=</span>HESLO_DO_VASI_WIFI
<span class="c1"># Use AES, instead of TKIP</span>
<span class="nv">rsn_pairwise</span><span class="o">=</span>CCMP
</pre></div>


<p>After saving the config file we can test if everything works as it should
using command:</p>
<div class="codehilite"><pre><span></span>sudo /usr/sbin/hostapd /etc/hostapd/hostapd.conf
</pre></div>


<p>Within several seconds you should be able to see your WiFi network. If you
try to connect to it your trial will not be successful as no IP address will
be assigned to you. That is covered in the following steps. Let us end the
running WiFi AP process with a combination of <c-c>.</p>
<p>There is one last thing to do in <em>hostapd</em> configuration. It is for the WiFi
to start after booting. Let us open this config file:</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/default/hostapd
</pre></div>


<p>Find this commented line:</p>
<div class="codehilite"><pre><span></span><span class="c1">#DAEMON_CONF=&quot;&quot;</span>
</pre></div>


<p>and replace the line with this:</p>
<div class="codehilite"><pre><span></span><span class="nv">DAEMON_CONF</span><span class="o">=</span><span class="s2">&quot;/etc/hostapd/hostapd.conf&quot;</span>
</pre></div>


<p>This will make sure that WiFi AP will start after the system startup.</p>
<p>:dnsmasq:</p>
<h4>dnsmasq configuration</h4>
<p>The <em>dnsmasq</em> configuration file contains a huge amount of (for us) unneeded
information. Therefore we rename the original file and create our own:</p>
<div class="codehilite"><pre><span></span>sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig
sudo nano /etc/dnsmasq.conf
</pre></div>


<p>Insert this content:</p>
<div class="codehilite"><pre><span></span><span class="nv">interface</span><span class="o">=</span>wlan0                           <span class="c1"># Use interface wlan0</span>
listen-address<span class="o">=</span><span class="m">192</span>.168.1.1                <span class="c1"># Explicitly specify the address to listen on</span>
bind-interfaces                           <span class="c1"># Bind to the interface to make sure we aren&#39;t sending things elsewhere</span>
<span class="nv">server</span><span class="o">=</span><span class="m">8</span>.8.8.8                            <span class="c1"># Forward DNS requests to Google DNS</span>
domain-needed                             <span class="c1"># Don&#39;t forward short names</span>
bogus-priv                                <span class="c1"># Never forward addresses in the non-routed address spaces.</span>
dhcp-range<span class="o">=</span><span class="m">192</span>.168.1.10,192.168.1.100,12h <span class="c1"># Assign IP addresses between 192.168.1.10 and 192.168.1.100 with a 12 hour lease time</span>
</pre></div>


<p>:IPv4_Forwarding:</p>
<h4>IPv4 Forwarding configuration</h4>
<p>At this moment we have a functioning <em>WiFi hotspot</em> to which client devices
can connect and which are allocated an IP address. The only thing left is
to add internet connection. In our case it will be from <em>Ethernet</em> (<em>eth0</em>).</p>
<p>First <em>IPv4 Forwarding</em> must be allowed. Open <em>sysctl.conf</em></p>
<div class="codehilite"><pre><span></span>sudo nano /etc/sysctl.conf
</pre></div>


<p>and uncomment (delete #) line containing:</p>
<div class="codehilite"><pre><span></span>net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span>
</pre></div>


<p>This setting will apply after the system reboot so either reboot system</p>
<div class="codehilite"><pre><span></span>sudo reboot -h now
</pre></div>


<p>or use following command:</p>
<div class="codehilite"><pre><span></span>sudo sh -c <span class="s2">&quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;</span>
</pre></div>


<p>Now only the <em>iptables</em> setup is left. We have to set up <em>NAT</em> between <em>wlan0</em>
and <em>eth0</em> (WiFi and Ethernet). This will be simply done using these commands:</p>
<div class="codehilite"><pre><span></span>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
</pre></div>


<p>This setting is <em>deleted</em> after each system restart. To override this we can
save the current configuration:</p>
<div class="codehilite"><pre><span></span>sudo sh -c <span class="s2">&quot;iptables-save &gt; /etc/iptables.ipv4.nat&quot;</span>
</pre></div>


<p>To make sure the <em>/etc/iptables.ipv4.nat</em> is read after system start we edit
the <em>rc.local</em> file:</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/rc.local
</pre></div>


<p>and add the following line before the <code>exit 0</code> line:</p>
<div class="codehilite"><pre><span></span>iptables-restore &lt; /etc/iptables.ipv4.nat
</pre></div>


<h4>Finish</h4>
<p>At this moment we're finished. Everything should work after <em>restarting</em> the
system. If you don't want to restart, it is enough to run these two services:</p>
<div class="codehilite"><pre><span></span>sudo service hostapd start
sudo service dnsmasq start
</pre></div>


<h4>Notes</h4>
<p>If something is not working:</p>
<p><em>WiFi Hotspot</em> -- look for an error in [[#hostapd|hostapd]] configuration.
WiFi is visible but no <em>IP address</em> is assigned -- configure [[#dnsmasq|dnsmasq]] section.
You can connect to WiFi and an IP address is assigned but <em>internet</em> does not
work -- check network connection of the source adapter (<em>eth0</em> in this case)
and the [[#IPv4_Forwarding|IPv4 Forwarding]] configuration section.</p>
<h4>script for wlan0</h4>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># script to set up WiFi hotspot on Raspberry Pi 3</span>

<span class="c1"># install packages------------------------------------------</span>
sudo apt-get install dnsmasq hostapd

<span class="c1"># configure network-----------------------------------------</span>
<span class="c1"># backup /etc/dhcpcd.conf</span>
sudo cp /etc/dhcpcd.conf /etc/dhcpcd.conf.orig

<span class="c1"># add a line to /etc/dhcpcd.conf</span>
sudo sh -c <span class="s2">&quot;echo denyinterfaces wlan0 &gt;&gt; /etc/dhcpcd.conf&quot;</span>

<span class="c1"># backup /etc/network/interfaces</span>
sudo cp /etc/network/interfaces /etc/network/interfaces.orig

<span class="c1"># edit /etc/network/interfaces</span>
<span class="nv">text2add</span><span class="o">=</span><span class="s1">&#39;allow-hotplug wlan0</span>
<span class="s1">iface wlan0 inet static</span>
<span class="s1">    address 192.168.1.1</span>
<span class="s1">    netmask 255.255.255.0</span>
<span class="s1">    network 192.168.1.0</span>
<span class="s1">    broadcast 192.168.1.255</span>
<span class="s1">#    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf&#39;</span>
sudo sh -c <span class="s2">&quot;echo \&#39;</span><span class="si">${</span><span class="nv">text2add</span><span class="si">}</span><span class="s2">\&#39; &gt;&gt; /etc/network/interfaces&quot;</span>

<span class="c1"># restart dhcpcd</span>
sudo service dhcpcd restart

<span class="c1"># reset wlan0 settings</span>
sudo ifdown wlan0<span class="p">;</span> sudo ifup wlan0

<span class="c1"># configuring hostapd---------------------------------------</span>
<span class="c1"># backup /etc/hostapd/hostapd.conf if exits</span>
<span class="k">if</span> <span class="o">[</span> -f /etc/hostapd/hostapd.conf <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  sudo cp /etc/hostapd/hostapd.conf /etc/hostapd/hostapd.conf.orig
<span class="k">fi</span>

<span class="c1"># edit /etc/hostapd/hostapd.conf</span>
<span class="nv">MY_SSID</span><span class="o">=</span><span class="s2">&quot;&lt;my_ssid&gt;&quot;</span>
<span class="nv">MY_PWD</span><span class="o">=</span><span class="s2">&quot;&lt;my_password&gt;&quot;</span>
<span class="nv">text2add</span><span class="o">=</span><span class="s2">&quot;# This is the name of the WiFi interface we configured above</span>
<span class="s2">interface=wlan0</span>
<span class="s2"># Use the nl80211 driver with the brcmfmac driver</span>
<span class="s2">driver=nl80211</span>
<span class="s2"># This is the name of the network</span>
<span class="s2">ssid=</span><span class="si">${</span><span class="nv">MY_SSID</span><span class="si">}</span><span class="s2">            # SSID_VASI_WIFI</span>
<span class="s2"># Use the 2.4GHz band</span>
<span class="s2">hw_mode=g</span>
<span class="s2"># Use channel 6</span>
<span class="s2">channel=6</span>
<span class="s2"># Enable 802.11n</span>
<span class="s2">ieee80211n=1</span>
<span class="s2"># Enable WMM</span>
<span class="s2">wmm_enabled=1</span>
<span class="s2"># Enable 40MHz channels with 20ns guard interval</span>
<span class="s2">ht_capab=[HT40][SHORT-GI-20][DSSS_CCK-40]</span>
<span class="s2"># Accept all MAC addresses</span>
<span class="s2">macaddr_acl=0</span>
<span class="s2"># Use WPA authentication</span>
<span class="s2">auth_algs=1</span>
<span class="s2"># Require clients to know the network name</span>
<span class="s2">ignore_broadcast_ssid=0</span>
<span class="s2"># Use WPA2</span>
<span class="s2">wpa=2</span>
<span class="s2"># Use a pre-shared key</span>
<span class="s2">wpa_key_mgmt=WPA-PSK</span>
<span class="s2"># The network passphrase</span>
<span class="s2">wpa_passphrase=</span><span class="si">${</span><span class="nv">MY_PWD</span><span class="si">}</span><span class="s2">        #HESLO_DO_VASI_WIFI</span>
<span class="s2"># Use AES, instead of TKIP</span>
<span class="s2">rsn_pairwise=CCMP&quot;</span>
sudo sh -c <span class="s2">&quot;echo </span><span class="si">${</span><span class="nv">text2add</span><span class="si">}</span><span class="s2"> &gt;&gt; /etc/hostapd/hostapd.conf&quot;</span>

<span class="c1"># test if everything works</span>
sudo /usr/sbin/hostapd /etc/hostapd/hostapd.conf

<span class="c1"># autoboot hotspot on startup (find #DAEMON_CONF=&quot;&quot; in /etc/default/hostapd and replace it with DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;</span>
sudo cp /etc/default/hostapd /etc/default/hostapd.orig <span class="c1"># backup</span>
sudo sed -i -e <span class="s1">&#39;s/#DAEMON_CONF=&quot;&quot;/DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;/g&#39;</span> /etc/default/hostapd  <span class="c1"># replace</span>

<span class="c1"># dnsmasq configuration-------------------------------------</span>
sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig <span class="c1"># backup</span>

<span class="nv">text2add</span><span class="o">=</span><span class="s2">&quot;interface=wlan0                           # Use interface wlan0</span>
<span class="s2">listen-address=192.168.1.1                # Explicitly specify the address to listen on</span>
<span class="s2">bind-interfaces                           # Bind to the interface to make sure we aren&#39;t sending things elsewhere</span>
<span class="s2">server=8.8.8.8                            # Forward DNS requests to Google DNS</span>
<span class="s2">domain-needed                             # Don&#39;t forward short names</span>
<span class="s2">bogus-priv                                # Never forward addresses in the non-routed address spaces.</span>
<span class="s2">dhcp-range=192.168.1.10,192.168.1.100,12h # Assign IP addresses between 192.168.1.10 and 192.168.1.100 with a 12 hour lease time&quot;</span>

sudo sh -c <span class="s2">&quot;echo </span><span class="si">${</span><span class="nv">text2add</span><span class="si">}</span><span class="s2"> &gt;&gt; /etc/dnsmasq.conf&quot;</span>

<span class="c1"># ipv4 forwarding-------------------------------------------</span>
sudo cp /etc/sysctl.conf /etc/sysctl.conf.orig <span class="c1"># backup</span>
sudo sed -i -e <span class="s1">&#39;s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g&#39;</span> /etc/sysctl.conf <span class="c1"># replace line</span>

sudo sh -c <span class="s2">&quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;</span>  <span class="c1"># reread the settings</span>

<span class="c1"># set up IP tables-----------------------------------------</span>
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT

<span class="c1"># save the IP tables configuration</span>
sudo sh -c <span class="s2">&quot;iptables-save &gt; /etc/iptables.ipv4.nat&quot;</span>

<span class="c1"># set up automatic reading of IP tables configuration with boot</span>
sudo cp /etc/rc.local /etc/rc.local.orig <span class="c1"># backup</span>
<span class="nv">text2add</span><span class="o">=</span><span class="s2">&quot;iptables-restore &lt; /etc/iptables.ipv4.nat</span>

<span class="s2">exit 0&quot;</span>
sudo sed <span class="s1">&#39;s/exit 0/&#39;</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">text2add</span><span class="si">}</span><span class="s2">&quot;</span><span class="s1">&#39;/g&#39;</span> /etc/rc.local
<span class="c1">#awk &#39;/exit 0/ { print; print &quot;&#39;&quot;${text2add}&quot;&#39;&quot;; next }1&#39; /etc/rc.local</span>

<span class="c1"># start the services</span>
sudo service hostapd start
sudo service dnsmasq start
</pre></div>


<h3>Raspberry Pi 4</h3>
<h4>wlan1</h4>
<p>Needs wlan1 device to have <em>persistent name</em> and <em>static IP address</em>.</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>


<span class="k">function</span> backup<span class="o">()</span> <span class="o">{</span>
  sudo cp <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>.orig
<span class="o">}</span>

<span class="c1"># change dir to /etc</span>
<span class="nb">cd</span> /etc

<span class="c1"># install the packages</span>
<span class="c1"># sudo apt-get install dnsmasq hostapd</span>

<span class="c1"># commit git repository</span>
sudo git add .
sudo git commit -m <span class="s2">&quot;Just before hotspot setup&quot;</span>

<span class="c1"># add interface to the end of /etc/dhcpcd.conf</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] /etc/dhcpcd.conf&quot;</span>
backup /etc/dhcpcd.conf
<span class="nv">text</span><span class="o">=</span><span class="s2">&quot;</span>
<span class="s2">interface wlan1</span>
<span class="s2">    static ip_address=10.0.1.1/24</span>
<span class="s2">    nohook wpa_supplicant</span>
<span class="s2">&quot;</span>
sudo bash -c <span class="s2">&quot;echo \&quot;</span><span class="si">${</span><span class="nv">text</span><span class="si">}</span><span class="s2">\&quot; &gt;&gt; /etc/dhcpcd.conf&quot;</span>

<span class="c1"># restart dhcpcd service</span>
sudo systemctl restart dhcpcd

<span class="c1"># configuring DHCP server (dnsmasq)</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] /etc/dnsmasq.conf&quot;</span>
backup /etc/dnsmasq.conf
<span class="nv">text</span><span class="o">=</span><span class="s2">&quot;interface=wlan1</span>
<span class="s2">listen-address=10.0.1.1</span>
<span class="s2">bind-interfaces</span>
<span class="s2">server=8.8.8.8</span>
<span class="s2">domain-needed</span>
<span class="s2">bogus-priv</span>
<span class="s2">dhcp-range=10.0.1.2,10.0.1.30,255.255.255.0,24h&quot;</span>
sudo bash -c <span class="s2">&quot;echo \&quot;</span><span class="si">${</span><span class="nv">text</span><span class="si">}</span><span class="s2">\&quot; &gt; /etc/dnsmasq.conf&quot;</span>

<span class="c1"># reload DHCP service</span>
sudo systemctl reload dnsmasq

<span class="c1"># configure the access point host software (hostapd)</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] /etc/hostapd/hostapd.conf&quot;</span>
<span class="k">if</span> <span class="o">[</span> -f /etc/hostapd/hostapd.conf <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  backup /etc/hostapd/hostapd.conf
<span class="k">fi</span>
<span class="nv">MY_SSID</span><span class="o">=</span><span class="s2">&quot;&lt;my_ssid&gt;&quot;</span>
<span class="nv">MY_PSWD</span><span class="o">=</span><span class="s2">&quot;&lt;my_password&gt;&quot;</span>
<span class="nv">text</span><span class="o">=</span><span class="s2">&quot;interface=wlan1</span>
<span class="s2">#driver=nl80211</span>
<span class="s2">ssid=</span><span class="si">${</span><span class="nv">MY_SSID</span><span class="si">}</span><span class="s2"></span>
<span class="s2">hw_mode=g</span>
<span class="s2">channel=7</span>
<span class="s2">wmm_enabled=0</span>
<span class="s2">macaddr_acl=0</span>
<span class="s2">auth_algs=1</span>
<span class="s2">ignore_broadcast_ssid=0</span>
<span class="s2">wpa=2</span>
<span class="s2">wpa_passphrase=</span><span class="si">${</span><span class="nv">MY_PSWD</span><span class="si">}</span><span class="s2"></span>
<span class="s2">wpa_key_mgmt=WPA-PSK</span>
<span class="s2">wpa_pairwise=TKIP</span>
<span class="s2">rsn_pairwise=CCMP&quot;</span>
sudo bash -c <span class="s2">&quot;echo \&quot;</span><span class="si">${</span><span class="nv">text</span><span class="si">}</span><span class="s2">\&quot; &gt;&gt; /etc/hostapd/hostapd.conf&quot;</span>
sudo sed -i -e <span class="s1">&#39;s/#DAEMON_CONF=\&quot;\&quot;/DAEMON_CONF=\&quot;\/etc\/hostapd\/hostapd.conf\&quot;/g&#39;</span> /etc/default/hostapd

<span class="c1"># start the services</span>
sudo systemctl unmask hostapd
sudo systemctl <span class="nb">enable</span> hostapd
sudo systemctl start hostapd

<span class="c1"># add routing and masqerade</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] /etc/sysctl.conf&quot;</span>
sudo sed -i -e <span class="s1">&#39;s/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g&#39;</span> /etc/sysctl.conf

<span class="c1"># add a masqerade for outbound traffic on wlan0</span>
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan1 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan1 -o eth0 -j ACCEPT
sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
sudo iptables -A FORWARD -i wlan0 -o wlan1 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan1 -o wlan0 -j ACCEPT
sudo bash -c <span class="s2">&quot;iptables-save &gt; /etc/iptables.ipv4.nat&quot;</span>

<span class="c1"># edit /etc/rc.local to install these rules on boot</span>
<span class="nb">echo</span> <span class="s2">&quot;[+] /etc/rc.local&quot;</span>
<span class="k">if</span> <span class="o">[</span> -f /etc/rc.local <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  backup /etc/rc.local
<span class="k">fi</span>
sudo sed -i -e <span class="s1">&#39;$s/exit 0/iptables-restore &lt; \/etc\/iptables.ipv4.nat/g&#39;</span> /etc/rc.local
sudo bash -c <span class="s2">&quot;echo &gt;&gt; /etc/rc.local&quot;</span>
sudo bash -c <span class="s2">&quot;echo &#39;exit 0&#39; &gt;&gt; /etc/rc.local&quot;</span>
</pre></div>


<h1>swap size</h1>
<div class="codehilite"><pre><span></span>sudo /bin/dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/var/swap.1 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">1024</span>
sudo /sbin/mkswap /var/swap.1
sudo chmod <span class="m">600</span> /var/swap.1
sudo /sbin/swapon /var/swap.1
</pre></div>


<p><a href="index.html">back to index</a></p>

    </body>
</html>
