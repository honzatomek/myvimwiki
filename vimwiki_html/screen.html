<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="date" content="2020-06-09" scheme="YYYY-MM-DD">
        <meta name="viewport" content="width=device-width" />
        <title>screen</title>
        <link rel="stylesheet" href="./style.css" type="text/css"
         media="screen" title="no title" charset="utf-8">
        <link rel="stylesheet" href="./pygmentize.css" type="text/css"
         media="screen" title="no title" charset="utf-8">
    </head>
    <body>

<h1>Contents</h1>
<ul>
<li><a href="#layout">layout</a><ul>
<li><a href="#layout#default%20layout%20for%20new%20screen's">default layout for new screen's</a></li>
<li><a href="#layout#session%20with%20custom%20.screenrc">session with custom .screenrc</a><ul>
<li><a href="#layout#session%20with%20custom%20.screenrc#example">example</a></li>
</ul>
</li>
<li><a href="#layout#kill%20all%20detached%20sessions">kill all detached sessions</a></li>
</ul>
</li>
</ul>
<h1>layout</h1>
<p>https://superuser.com/questions/687348/how-to-persist-gnu-screen-layout-after-restart</p>
<h2>default layout for new screen's</h2>
<ul>
<li>Manage your regions, then execute code inside screen:<ul>
<li>To save your current layout to file .screen_layout:</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span>rm -f <span class="nv">$HOME</span>/.screen_layout
screen -X layout dump .screen_layout
</pre></div>


<div class="codehilite"><pre><span></span>* To make it auto-loading with layout saving:
</pre></div>


<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="nb">source</span> .screen_layout  &gt;&gt; <span class="nv">$HOME</span>/.screenrc
<span class="nb">echo</span> layout save def &gt;&gt; <span class="nv">$HOME</span>/.screenrc
</pre></div>


<ul>
<li>
<p>How it works:
    1) You type screen.
    2) Screen reads <em>$HOME/.screenrc</em>:
    3) <code>source .screen_layout</code> - read and execute commands from <em>$HOME/.screen_layout</em>
       Regions now created.
    4) <code>layout save def</code> - save current regions as layout to keep it when you detach.</p>
</li>
<li>
<p><code>layout dump .screen_layout</code>:
    Dump (append) current layout to file in <em>$HOME</em> directory.</p>
</li>
<li>
<p><code>screen -X command</code>:
    Run <em>command</em> in current screen session (if executed inside).
    Similar to <em><ctrl+a></em> then <em>:</em> command.</p>
</li>
<li>
<p>You may also disable copyright notice at startup:</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> startup_message off &gt;&gt; <span class="nv">$HOME</span>/.screenrc
</pre></div>


<ul>
<li>Increase scroll buffer (def. 100):</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> defscrollback <span class="m">1000</span> &gt;&gt; <span class="nv">$HOME</span>/.screenrc
</pre></div>


<ul>
<li>Write own <em>.screen_layout</em> (50% / 50% vertical, with 2 shells):</li>
</ul>
<div class="codehilite"><pre><span></span>split -v
screen -t s1

focus
screen -t s2

focus
</pre></div>


<h2>session with custom .screenrc</h2>
<p>creates a new session by ${session_name} and runs custom rc file for it</p>
<div class="codehilite"><pre><span></span>screen -S <span class="s2">&quot;</span><span class="si">${</span><span class="nv">session_name</span><span class="si">}</span><span class="s2">&quot;</span> -c ~/.screenrc_custom
</pre></div>


<p>can be scripted:
1) create a default .screenrc file
2) create an rc file for each custom predefined session
3) source the default .screenrc file inside
4) create a custom layout file
5) source a layout file inside, don't forget to include <code>layout save def</code> at the end of the custom rc file
6) write a script that checks if a session by given name is running:
    * if session is running --&gt; attach
    * if session is not running --&gt; create</p>
<p>screen existing + attach/create example:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>screen -ls <span class="p">|</span> grep <span class="s2">&quot;</span><span class="si">${</span><span class="nv">session_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    screen -x <span class="s2">&quot;</span><span class="si">${</span><span class="nv">session_name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span>
    screen -S <span class="s2">&quot;</span><span class="si">${</span><span class="nv">session_name</span><span class="si">}</span><span class="s2">&quot;</span> -c ~/.screenrc_custom
<span class="k">fi</span>
</pre></div>


<h3>example</h3>
<ul>
<li>list of files:</li>
</ul>
<div class="codehilite"><pre><span></span>.
├── python3/
│   └── .screenrc_python
├── screenpython*
└── .screenrc

<span class="m">1</span> directory, <span class="m">5</span> files
</pre></div>


<ul>
<li>default <strong>.screenrc</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span>startup_message off
defscrollback <span class="m">1000</span>

shell /bin/bash
</pre></div>


<ul>
<li>custom <strong>./python3/.screenrc_python</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="nb">source</span> .screenrc

split -v
resize <span class="m">60</span>%
screen -t <span class="s1">&#39;edit&#39;</span> -X bash -c <span class="s2">&quot;cd </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/Programming/PYTHON3/bin/; vim&quot;</span>

focus
screen -t <span class="s1">&#39;repl&#39;</span> -X /usr/bin/env python3

focus

layout save def
</pre></div>


<ul>
<li>script to <strong>start</strong> or <strong>attach to</strong> a <strong>named session</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">SCRIPT</span><span class="o">=</span><span class="k">$(</span>readlink -m <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">SCRIPTPATH</span><span class="o">=</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SCRIPT</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">SCREENRC</span><span class="o">=</span><span class="s2">&quot;.screenrc&quot;</span>
<span class="nv">SESSIONRC</span><span class="o">=</span><span class="s2">&quot;.screenrc_python&quot;</span>
<span class="nv">SESSIONLAYOUT</span><span class="o">=</span><span class="s2">&quot;.screen_python_layout&quot;</span>
<span class="nv">SESSION</span><span class="o">=</span><span class="s1">&#39;python3&#39;</span>

<span class="k">if</span> <span class="o">[[</span> ! -e <span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;[\033[01;31e-\033[0m] - </span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2"> missing in </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;[\033[01;33ei\033[0m] - copying generic </span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2"> to </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">&quot;</span>
  cp <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SCRIPTPATH</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;[\033[01;32e+\033[0m] - </span><span class="si">${</span><span class="nv">SCREENRC</span><span class="si">}</span><span class="s2"> found in </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>screen -ls <span class="p">|</span> grep <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SESSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
  screen -x <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SESSION</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span>
  screen -S <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SESSION</span><span class="si">}</span><span class="s2">&quot;</span> -c <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SCRIPTPATH</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SESSION</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SESSIONRC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>


<h2>kill all detached sessions</h2>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

screen -ls <span class="p">|</span> grep Detached <span class="p">|</span> cut -d. -f1 <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> xargs <span class="nb">kill</span>
</pre></div>


<p><a href="index.html">back to index</a></p>

    </body>
</html>
